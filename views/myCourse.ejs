<%- include('includes/head.ejs') %>
<title><%= user.firstname %>'s Dashboard</title>
</head>

<body>
  <%- include('includes/nav.ejs') %>

  <!-- ... (keep Welcome Header) ... -->
     <section class="probootstrap-section probootstrap-section-colored">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center probootstrap-animate">
          <!-- Use fadeInUp animation or similar if available in probootstrap -->
          <h1 class="text-white mb-1">Welcome, <%= user.firstname %>!</h1>
          <p class="text-white lead" style="font-size: 2.1rem;">Here's your personal dashboard.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="probootstrap-section">
    <div class="container">
      <div class="row">
        <!-- Column 1: User Profile Card -->
        <div class="col-lg-4 col-md-5 mb-4 mb-md-0 probootstrap-animate">
          <!-- Use fadeInLeft animation or similar -->
          <div class="profile-card">
            <div class="card-body text-center">
              <!-- Placeholder Avatar - Replace with real image logic if available -->
              <div class="profile-avatar">
                <i class="fas fa-user"></i> <!-- Font Awesome user icon -->
              </div>
              <h4 class="card-title"><%= user.firstname %> <%= user.lastname %></h4>
              <p class="text-muted mb-4"><%= user.type %> Account</p>

              <ul class="list-unstyled text-left details-list">
                <li><i class="fas fa-envelope"></i> <%= user.email %></li>
                <li><i class="fas fa-graduation-cap"></i> <%= course.length %> Registered Course<%= course.length !== 1 ? 's' : '' %></li>
                <!-- Add more user details here if needed -->
                <!-- Example: <li><i class="fas fa-calendar-alt"></i> Member Since: [Date]</li> -->
                <!-- Example: <li><i class="fas fa-phone"></i> [Phone Number]</li> -->
              </ul>

              <!-- Action Buttons -->
              <!-- <a href="/edit-profile" class="btn btn-primary btn-sm mb-2 w-100"><i class="fas fa-user-edit me-1"></i> Edit Profile</a> -->
              <a href="/reset" class="btn btn-outline-secondary btn-sm w-100"><i class="fas fa-key me-1"></i> Change Password</a>
            </div>
          </div>
        </div>

        <!-- Column 2: Registered Courses and their Subjects -->
        <div class="col-lg-8 col-md-7 probootstrap-animate">

          <% if (!user.purchasedCourses || user.purchasedCourses.length === 0) { %>
            <!-- ... (Keep 'No Courses Yet' message) ... -->
            <div class="alert alert-info" role="alert">
              <h4 class="alert-heading"><i class="fas fa-info-circle"></i> No Courses Yet!</h4>
              <p>You haven't registered for any course programs. Ready to start learning?</p>
              <hr>
              <a href="/courses" class="btn btn-primary btn-sm mb-0"><i class="fas fa-search"></i> Browse Course Programs</a>
            </div>
          <% } else { %>
            <!-- Iterate over each MAIN course program the user purchased -->
            <% user.purchasedCourses.forEach(program => { %>
              <div class="mb-5"> <!-- Add spacing between programs -->
                <h2 class="mb-3"><%= program.title %></h2>
                <p><%= program.description %></p>
                <hr>
                <h3 class="mb-3">Subjects in this Program:</h3>

                <% if (!program.subjects || program.subjects.length === 0) { %>
                  <p class="text-muted">No subjects listed for this program yet.</p>
                <% } else { %>
                  <div class="list-group">
                    <!-- Iterate over the SUBJECTS within the current program -->
                    <% program.subjects.forEach(subject => { %>
                      <div class="list-group-item list-group-item-action flex-column align-items-start mb-3">
                        <div class="d-flex w-100 justify-content-between">
                          <h5 class="mb-1"><%= subject.title %> (<%= subject.code %>)</h5>
                          <small><%= subject.units %> unit<%= subject.units !== 1 ? 's' : '' %></small>
                        </div>
                        <!-- Placeholder for links to subject details -->
                        <div class="mt-2">
                           <!-- These links would go to new routes/views -->
                           <a href="/courses/<%= program._id %>/subjects/<%= subject._id %>/assignments" class="btn btn-sm btn-outline-info me-2"><i class="fas fa-tasks"></i> Assignments</a>
                           <a href="/courses/<%= program._id %>/subjects/<%= subject._id %>/projects" class="btn btn-sm btn-outline-success me-2"><i class="fas fa-lightbulb"></i> Projects</a>
                           <a href="/courses/<%= program._id %>/subjects/<%= subject._id %>/attendance" class="btn btn-sm btn-outline-warning"><i class="fas fa-user-check"></i> Attendance</a>
                           <!-- You'll need to create routes and views for these ^ -->
                        </div>
                         

                      </div>
                    <% }); %>
                  </div>
                <% } %>
              </div>
            <% }); %>
          <% } %>
        </div> <!-- / End Courses Column -->
      </div> <!-- / End Main Row -->
    </div> <!-- / End Container -->
  </section>

  <%- include('includes/footer.ejs') %>
  <%- include('includes/end.ejs') %>