<%- include('../includes/head.ejs') %>
<body>
  <%- include('../includes/nav.ejs') %>

  <section class="probootstrap-section probootstrap-section-colored">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-left section-heading probootstrap-animate">
          <h1><%= editing ? 'Edit Course' : 'Add Course' %></h1>
        </div>
      </div>
    </div>
  </section>

  <section class="probootstrap-section">
    <div class="container">
      <div class="row">
        <div class="col-md-8 col-md-offset-2 probootstrap-animate">
          <% if (errorMessage && errorMessage.length > 0) { %>
          <div class="alert alert-danger mb30" role="alert">
            <%= errorMessage %>
          </div>
          <% } %>

          <form
            action="/admin/courses/<%= editing ? course._id + '/edit' : 'add' %>"
            method="POST"
            class="probootstrap-form"
            enctype="multipart/form-data"
          >
            <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

            <div class="form-group">
              <label for="title">Course Title</label>
              <input
                type="text"
                class="form-control <%= validationErrors.find(e => e.path === 'title') ? 'is-invalid' : '' %>"
                id="title"
                name="title"
                value="<%= oldInput.title %>"
                required
              />
            </div>
            <div class="form-group">
              <label for="description">Description</label>
              <textarea
                class="form-control <%= validationErrors.find(e => e.path === 'description') ? 'is-invalid' : '' %>"
                id="description"
                name="description"
                rows="5"
                required
              ><%= oldInput.description %></textarea>
            </div>
            <div class="form-group">
              <label for="date">Date</label>
              <input
                type="text"
                class="form-control <%= validationErrors.find(e => e.path === 'date') ? 'is-invalid' : '' %>"
                id="date"
                name="date"
                value="<%= oldInput.date %>"
                placeholder="e.g., Jan 1 - Mar 30"
                required
              />
            </div>
            <div class="form-group">
              <label for="price">Price</label>
              <input
                type="number"
                class="form-control <%= validationErrors.find(e => e.path === 'price') ? 'is-invalid' : '' %>"
                id="price"
                name="price"
                value="<%= oldInput.price %>"
                step="0.01"
                min="0"
                required
              />
            </div>
            <div class="form-group">
              <label for="image">Course Image</label>
              <% if (editing && oldInput.imgUrl) { %>
                <div class="current-image-preview mb20">
                  <p>Current Image:</p>
                  <img src="/<%= oldInput.imgUrl %>" alt="Current Course Image" style="max-width: 200px; height: auto; border: 1px solid #ddd; padding: 5px;">
                </div>
              <% } %>
              <input
                type="file"
                class="form-control-file <%= validationErrors.find(e => e.path === 'image') ? 'is-invalid' : '' %>"
                id="image"
                name="image"
              />
              <% if (editing && !oldInput.imgUrl) { %>
                <small class="form-text text-muted">No image currently set. Please upload one.</small>
              <% } else if (!editing) { %>
                <small class="form-text text-muted">Upload an image for the new course.</small>
              <% } %>
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-primary">
                <%= editing ? 'Update Course' : 'Add Course' %>
              </button>
              <a href="/admin" class="btn btn-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <%- include('../includes/footer.ejs') %> <%- include('../includes/end.ejs') %>
